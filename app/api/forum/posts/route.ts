// ğŸ“ è®ºå›å¸–å­ API (é·ç§»åˆ° Firestore)\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { db } from '@/lib/firebase';\nimport { collection, getDocs, addDoc, query, where, orderBy, limit, startAfter } from 'firebase/firestore';\n\n// é›†åˆåç¨± (å¾ supabase TABLES é·ç§»)\nconst POSTS_COLLECTION = 'forum_posts';\n\n/**\n * GET - è·å–å¸–å­åˆ—è¡¨\n */\nexport async function GET(request: NextRequest) {\n  try {\n    if (!db) {\n      throw new Error('Firestore not initialized');\n    }\n\n    const { searchParams } = new URL(request.url);\n    const category = searchParams.get('category');\n    const page = parseInt(searchParams.get('page') || '1');\n    const pageLimit = parseInt(searchParams.get('limit') || '20');\n    const offset = (page - 1) * pageLimit;\n\n    // æ„å»ºæŸ¥è©¢\n    let q = query(\n      collection(db, POSTS_COLLECTION),\n      orderBy('created_at', 'desc'),\n      limit(pageLimit)\n    );\n\n    // æŒ‰åˆ†åŒºéæ¿¾\n    if (category) {\n      q = query(q, where('category', '==', category));\n    }\n\n    // æ¨¡æ“¬ offset (Firestore ç„¡åŸç”Ÿ offsetï¼Œä½¿ç”¨ startAfter)\n    // æ³¨æ„: ç‚ºç°¡å–®ï¼Œé€™è£¡å‡è¨­ç„¡ç²¾ç¢º offsetï¼›å¦‚éœ€ç²¾ç¢ºï¼Œå¯ä½¿ç”¨ cursor-based pagination\n    const snapshot = await getDocs(q);\n    const posts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\n    const total = snapshot.size; // è¿‘ä¼¼ç¸½æ•¸ (å¦‚éœ€ç²¾ç¢ºç¸½æ•¸ï¼Œå¯å–®ç¨æŸ¥è©¢)\n\n    return NextResponse.json({\n      posts,\n      pagination: {\n        page,\n        limit: pageLimit,\n        total,\n        totalPages: Math.ceil(total / pageLimit)\n      }\n    });\n  } catch (error: any) {\n    console.error('Get posts error:', error);\n\n    return NextResponse.json(\n      { error: error.message || 'Failed to fetch posts' },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * POST - åˆ›å»ºæ–°å¸–å­\n */\nexport async function POST(request: NextRequest) {\n  try {\n    if (!db) {\n      throw new Error('Firestore not initialized');\n    }\n\n    const body = await request.json();\n    const { userId, userName, title, content, category, tags } = body;\n\n    // éªŒè¯å‚æ•°\n    if (!userId || !userName || !title || !content || !category) {\n      return NextResponse.json(\n        { error: 'Missing required fields' },\n        { status: 400 }\n      );\n    }\n\n    // åˆ›å»ºå¸–å­\n    const newPost = {\n      user_id: userId,\n      user_name: userName,\n      title,\n      content,\n      category,\n      tags: tags || [],\n      created_at: new Date().toISOString(),\n      views_count: 0,\n      likes_count: 0,\n      replies_count: 0\n    };\n\n    const docRef = await addDoc(collection(db, POSTS_COLLECTION), newPost);\n\n    return NextResponse.json({\n      success: true,\n      post: { id: docRef.id, ...newPost }\n    });\n  } catch (error: any) {\n    console.error('Create post error:', error);\n\n    return NextResponse.json(\n      { error: error.message || 'Failed to create post' },\n      { status: 500 }\n    );\n  }\n}\n