// ğŸ’¬ è®ºå›å›å¤ API (é·ç§»åˆ° Firestore)\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { db } from '@/lib/firebase';\nimport { collection, getDocs, addDoc, query, where, orderBy, updateDoc, increment } from 'firebase/firestore';\n\n// é›†åˆåç¨±\nconst REPLIES_COLLECTION = 'forum_replies';\nconst POSTS_COLLECTION = 'forum_posts';\n\n/**\n * GET - è·å–å›å¤åˆ—è¡¨\n */\nexport async function GET(request: NextRequest) {\n  try {\n    if (!db) {\n      throw new Error('Firestore not initialized');\n    }\n\n    const { searchParams } = new URL(request.url);\n    const postId = searchParams.get('postId');\n\n    if (!postId) {\n      return NextResponse.json(\n        { error: 'Post ID required' },\n        { status: 400 }\n      );\n    }\n\n    // è·å–å›å¤\n    const q = query(\n      collection(db, REPLIES_COLLECTION),\n      where('post_id', '==', postId),\n      orderBy('created_at', 'asc')\n    );\n\n    const snapshot = await getDocs(q);\n    const replies = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\n\n    return NextResponse.json({ replies });\n  } catch (error: any) {\n    console.error('Get replies error:', error);\n\n    return NextResponse.json(\n      { error: error.message || 'Failed to fetch replies' },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * POST - åˆ›å»ºå›å¤\n */\nexport async function POST(request: NextRequest) {\n  try {\n    if (!db) {\n      throw new Error('Firestore not initialized');\n    }\n\n    const body = await request.json();\n    const { postId, userId, userName, content } = body;\n\n    // éªŒè¯å‚æ•°\n    if (!postId || !userId || !userName || !content) {\n      return NextResponse.json(\n        { error: 'Missing required fields' },\n        { status: 400 }\n      );\n    }\n\n    // åˆ›å»ºå›å¤\n    const newReply = {\n      post_id: postId,\n      user_id: userId,\n      user_name: userName,\n      content,\n      created_at: new Date().toISOString()\n    };\n\n    const docRef = await addDoc(collection(db, REPLIES_COLLECTION), newReply);\n\n    // æ›´æ–°å¸–å­çš„å›å¤æ•° (æ›¿æ› rpc)\n    await updateDoc(doc(db, POSTS_COLLECTION, postId), {\n      replies_count: increment(1)\n    });\n\n    return NextResponse.json({\n      success: true,\n      reply: { id: docRef.id, ...newReply }\n    });\n  } catch (error: any) {\n    console.error('Create reply error:', error);\n\n    return NextResponse.json(\n      { error: error.message || 'Failed to create reply' },\n      { status: 500 }\n    );\n  }\n}\n