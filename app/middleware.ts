// 伺服器端 Auth Middleware (使用 Firebase Admin)\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { getAuth } from 'firebase-admin/auth';\nimport { initializeApp, getApps, cert } from 'firebase-admin/app';\n\n// 初始化 Firebase Admin (僅一次)\nif (!getApps().length) {\n  initializeApp({\n    credential: cert(JSON.parse(process.env.FIREBASE_ADMIN_JSON || '{}')),\n  });\n}\n\n// 保護路由清單 (可擴展)\nconst protectedRoutes = ['/profile', '/settings', '/admin'];\n\n// Middleware 函數\nexport async function middleware(request: NextRequest) {\n  const { pathname } = request.nextUrl;\n\n  // 檢查是否為保護路由\n  if (protectedRoutes.some(route => pathname.startsWith(route))) {\n    const token = request.cookies.get('authToken')?.value;\n\n    if (!token) {\n      return NextResponse.redirect(new URL('/login', request.url));\n    }\n\n    try {\n      // 驗證 token\n      await getAuth().verifyIdToken(token);\n      return NextResponse.next();\n    } catch (error) {\n      console.error('Auth error:', error);\n      return NextResponse.redirect(new URL('/login', request.url));\n    }\n  }\n\n  return NextResponse.next();\n}\n\n// 配置 matcher (僅匹配 API 和保護路由)\nexport const config = {\n  matcher: ['/api/:path*', '/profile/:path*', '/settings/:path*', '/admin/:path*'],\n};\n