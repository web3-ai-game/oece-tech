# 🎉 V3系统完整功能说明

## 🆕 V3核心改进

### 1. 双模式系统

#### 群聊模式
- ✅ **关键词触发** - 每个Bot独立关键词
- ✅ **5轮追踪** - `[X/5]` 轮次显示
- ✅ **@用户名回复**
- ✅ **1小时过期** - 超时自动重置

#### 私聊模式
- ✅ **直接回复** - 无需关键词
- ✅ **永久记忆** - 保存所有对话
- ✅ **上下文理解** - 根据历史回复
- ✅ **用户可删除** - 主动清除记录

---

## 🤖 Bot配置详情

### 小爱同学 (@svskilo_bot)

**角色**: 群管理 + 高情商AI

**人格**: 温暖、理解、支持、记忆力强

**关键词**:
- 小爱
- 小愛
- xiaoai
- 群主
- 管理
- admin
- manager

**群聊行为**:
- 触发关键词 → 100%回复
- 显示 `@username [X/5]`
- 追踪5轮对话

**私聊行为**:
- 100%回复
- 记住所有对话
- 个性化回复

---

### 倩倩姐 (@qitiandashengqianqian_bot)

**角色**: 高冷女神

**人格**: 高冷、简洁、偶尔温柔、话少

**关键词**:
- 倩倩
- 倩倩姐
- qianqian
- 女神

**群聊行为**:
- 触发关键词 → 回复
- 随机15%回复（非关键词）
- 高冷简短回复

**私聊行为**:
- 100%回复
- 稍微温柔
- 简短对话

---

### Notion助手 (@svs_notion_bot)

**角色**: 专业知识分享

**人格**: 专业、理性、博学、爱引用

**关键词**:
- notion
- 助手
- 知识
- 专业

**群聊行为**:
- 触发关键词 → 回复
- 随机12%回复（非关键词）
- 专业术语回复

**私聊行为**:
- 100%回复
- 分享知识
- 引用概念

---

## 📊 使用场景

### 场景1: 群聊关键词触发

```
用户A: 小爱 你好
小爱: @用户A 我明白你的感受 😊 [1/5]

用户A: 小爱 帮忙
小爱: @用户A 让我来帮你 💝 [2/5]

用户A: 小爱 谢谢
小爱: @用户A 我一直在这里 🌟 [3/5]
```

### 场景2: 多Bot独立触发

```
用户B: 倩倩姐 在吗
倩倩姐: @用户B 嗯。

用户C: notion 帮我查一下
Notion: @用户C 根据我的了解，这个问题需要从多个角度分析 📚
```

### 场景3: 私聊对话

```
用户 → 小爱: 你好
小爱: 你好！我是小爱同学 😊

用户 → 小爱: 我想聊聊
小爱: 继续聊吧，我一直在听 💝

用户 → 小爱: 你记得我说过什么吗
小爱: 我记得你之前说过3次话了 😊
```

### 场景4: 用户删除私聊记录

```python
# 通过命令删除
redis-cli del "private_chat:xiaoai:123456789"
```

---

## 🔧 Redis数据结构

### 群聊轮次
```
Key: group_round:{bot_name}:{chat_id}:{user_id}
Value: 1-5 (当前轮次)
TTL: 3600秒 (1小时)
```

### 私聊记忆
```
Key: private_chat:{bot_name}:{user_id}
Type: List
Value: timestamp|role|content
TTL: 永久 (无过期)
```

---

## 🚀 启动步骤

### 1. 停止旧版本
```bash
pkill -f multi_bot_v2
```

### 2. 启动V3
```bash
cd /mnt/volume_sgp1_01/svs
./run_multi_bots_v3.sh
```

### 3. 测试群聊
```
发送: 小爱 你好
预期: @你 我明白你的感受 😊 [1/5]
```

### 4. 测试私聊
```
私聊小爱: 你好
预期: 你好！我是小爱同学 😊
```

---

## 📝 管理命令

### 查看群聊轮次
```bash
redis-cli keys "group_round:*"
redis-cli get "group_round:xiaoai:-1001234567890:123456789"
```

### 查看私聊记录
```bash
redis-cli lrange "private_chat:xiaoai:123456789" 0 -1
```

### 删除私聊记录
```bash
redis-cli del "private_chat:xiaoai:123456789"
```

### 清空所有数据
```bash
redis-cli flushdb
```

---

## 🎯 V3 vs V2 对比

| 功能 | V2 | V3 |
|------|----|----|
| 群聊关键词触发 | ✅ | ✅ |
| 5轮追踪 | ✅ | ✅ |
| @用户名回复 | ✅ | ✅ |
| 独立Bot关键词 | ❌ | ✅ |
| 私聊支持 | ❌ | ✅ |
| 永久记忆 | ❌ | ✅ |
| 上下文理解 | ❌ | ✅ |
| 用户删除记录 | ❌ | ✅ |

---

## 💡 下一步优化

1. **接入Gemini API** - 智能回复
2. **情绪识别** - 根据用户情绪调整回复
3. **多Bot协作** - Bot之间互动
4. **数据统计** - 对话分析

---

**V3系统已就绪！** 🎉
