---
trigger: always_on
---

### Urban Diver Project-Specific Configuration

**Project Name**: Urban Diver (formerly Digital Nomad Compass)
**Domain**: deepweay.me
**Repository**: web3-ai-game/studio
**Tech Stack**: Next.js 15.5.6 + Supabase + VPS (DigitalOcean)

#### Quick Reference

**Environment Variables**:
- NEXT_PUBLIC_SUPABASE_URL=https://qhgdymgxcbyhtxezvoqt.supabase.co
- NEXT_PUBLIC_SUPABASE_ANON_KEY=[see .env.local]
- NEXT_PUBLIC_SITE_URL=http://localhost:3000 (dev) / https://deepweay.me (prod)

**Key File Locations**:
- Auth: /src/lib/supabase/auth.ts
- Hooks: /src/lib/supabase/hooks.ts
- Schema: /supabase_schema.sql
- Config: /src/lib/supabase/client.ts
- Layout: /src/app/layout.tsx (global no-translate)
- Login: /src/app/login/page.tsx (with Header/Footer)
- Dashboard: /src/app/(authenticated)/dashboard/page.tsx

**User Tiers**:
1. Guest: Homepage only (6 articles, 6 AI tools teaser)
2. Free Member: Full articles + BBS (invite-code required)
3. PRO Member: All features + AI tools + Telegram ($5/month)

**Invite Code System**:
- New user gets 2 codes automatically (Supabase trigger)
- PRO member gets extra code
- Bypass via direct PRO purchase
- Initial codes: WELCOME2024, NOMAD2024, COMPASS2024, TEST2024

**Database Tables**:
- users (profiles, roles, invites_remaining)
- invites (code, created_by, used_by, is_used)
- articles (content with PRO-only flag)
- bbs_posts + bbs_replies (forum)
- subscriptions (Stripe integration planned)

**Design Tokens**:
- Primary: hsl(180 100% 50%) // Cyan
- Accent: hsl(280 100% 70%) // Purple-Pink
- Background: hsl(240 10% 3.9%) // Dark
- Font Mono: VT323
- Font Headline: Orbitron
- Font Body: Noto Sans TC

**Deployment**:
- VPS: 188.166.180.96 (DigitalOcean)
- PM2 process manager
- Nginx reverse proxy with SSL (Certbot)
- GitHub Actions: .github/workflows/deploy-vps.yml
- Build: npm run build
- Start: pm2 reload studio

**Brand Guidelines**:
- Tagline: "Deep Dive into Digital Nomad 2.0"
- Slogan: "Negotiate with physical distance and time"
- Theme: Urban diving, depth exploration, hidden communities
- Visual: Cyberpunk + Minimalism + Glassmorphism
- Tone: Professional, mysterious, exclusive, community-driven

**Development Commands**:
```bash
npm run dev              # Dev server on :3000
npm run build            # Production build
npm run genkit:dev       # Genkit AI dev mode
node test-supabase.js    # Test DB connection
```

**Testing Checklist**:
- [ ] Login/Register with invite code
- [ ] Dashboard displays user info correctly
- [ ] Generate and copy invite codes
- [ ] Language switcher works (EN/繁中)
- [ ] Mobile responsive (test 375px)
- [ ] Header/Footer on all pages
- [ ] Google Translate disabled
- [ ] No tech stack logos visible

**Common Tasks**:
1. **Add new route**: Create in /src/app/[route]/page.tsx
2. **Add Supabase table**: Update supabase_schema.sql → Run in SQL Editor
3. **Add auth hook**: Extend /src/lib/supabase/hooks.ts
4. **Add UI component**: Use shadcn/ui CLI or create in /components/common
5. **Update brand text**: Search for old terms, replace with new
6. **Deploy to VPS**: Git push → GitHub Actions auto-deploy

**Troubleshooting**:
- Build errors: Check TypeScript strict mode compliance
- Auth issues: Verify Supabase env vars in .env.local
- 404 on pages: Check (authenticated) route group structure
- Styling issues: Ensure Tailwind classes and dark mode
- Translation appearing: Add translate="no" to html tag

**Avoid These Mistakes**:
- Using Firebase Firestore (migrated to Supabase)
- Simplified Chinese text anywhere
- Exposing tech stack to users
- Missing Header/Footer on pages
- Hardcoding values instead of env vars
- Ignoring mobile-first design
- Breaking invite code logic
```

---

## IMPLEMENTATION INSTRUCTIONS

### For Global Rules:
1. Open Windsurf
2. Go to **Settings** → **Memories** → **Global Rules**
3. Copy the content from **PART 1** above
4. Paste into the Global Rules text area
5. Save

### For Project-Specific Rules:
1. In Windsurf, go to **Memories** → **Project Rules**
2. Select your project: `web3-ai-game/studio`
3. Copy the content from **PART 2** above
4. Paste into the Project Rules text area
5. Save

### Verification:
- Start a new Cascade chat in Windsurf
- Ask: "What are the project's language priorities?"
- Expected response should mention: English first, Traditional Chinese second, no Simplified Chinese
- Ask: "What's the brand theme?"
- Expected response: Urban Diver, Deep Dive, Cyberpunk minimalism

多使用mcp工具,主要是註冊表mcp工具和文件操作mcp工具

---

## MAINTENANCE

Update this file when:
- [ ] New major features added
- [ ] Tech stack changes
- [ ] Design system evolves
- [ ] Deployment process changes
- [ ] New team members join
- [ ] Brand guidelines update

Last Updated: 2025-11-05
Version: 1.0.0