# ğŸ¤– AIé›†æˆå®Œæˆ

## âœ… Gemini APIé›†æˆ

### æ ¸å¿ƒæ”¹è¿›

**ä¹‹å‰**ï¼šéšæœºæ¨¡æ¿å›å¤
```python
templates = [
    f"@{username} æˆ‘æ˜ç™½ä½ çš„æ„Ÿå— ğŸ˜Š [{round_num}/5]",
    f"@{username} è®©æˆ‘æ¥å¸®ä½  ğŸ’ [{round_num}/5]",
]
return random.choice(templates)  # âŒ æ— ä¸Šä¸‹æ–‡
```

**ç°åœ¨**ï¼šçœŸå®AIç†è§£å’Œå›å¤
```python
prompt = f"""ä½ æ˜¯å°çˆ±åŒå­¦ï¼Œæ¸©æš–ã€ç†è§£ã€æ”¯æŒçš„AIã€‚
ç”¨æˆ· @{username} è¯´ï¼š{user_message}
è¯·ç”¨é«˜æƒ…å•†æ–¹å¼å›å¤...
"""

response = await gemini_model.generate_content(prompt)
return response.text  # âœ… çœŸå®ç†è§£ç”¨æˆ·
```

---

## ğŸ¯ AIå›å¤ç‰¹ç‚¹

### 1. ä¸Šä¸‹æ–‡ç†è§£
- âœ… ç†è§£ç”¨æˆ·è¯´çš„å†…å®¹
- âœ… æ ¹æ®å†…å®¹ç”Ÿæˆå›å¤
- âœ… ä¸é‡å¤ç”¨æˆ·çš„è¯

### 2. äººæ ¼ä¸€è‡´
- âœ… æ¸©æš–ã€ç†è§£ã€æ”¯æŒ
- âœ… é«˜æƒ…å•†å›å¤
- âœ… ç®€çŸ­ï¼ˆ1-2å¥è¯ï¼‰

### 3. æ ¼å¼è§„èŒƒ
- âœ… ä»¥ @username å¼€å¤´
- âœ… ä»¥ [X/5] ç»“å°¾
- âœ… ä¿æŒè½®æ¬¡æ ‡è®°

---

## ğŸ§ª æµ‹è¯•å¯¹æ¯”

### æ¨¡æ¿å›å¤ï¼ˆä¹‹å‰ï¼‰
```
ç”¨æˆ·: ä»Šå¤©å¤©æ°”çœŸå¥½
Bot: @ç”¨æˆ· æˆ‘æ˜ç™½ä½ çš„æ„Ÿå— ğŸ˜Š [1/5]  âŒ ä¸ç›¸å…³

ç”¨æˆ·: æˆ‘å¾ˆå¼€å¿ƒ
Bot: @ç”¨æˆ· è®©æˆ‘æ¥å¸®ä½  ğŸ’ [2/5]  âŒ ä¸ç›¸å…³
```

### AIå›å¤ï¼ˆç°åœ¨ï¼‰
```
ç”¨æˆ·: ä»Šå¤©å¤©æ°”çœŸå¥½
Bot: @ç”¨æˆ· æ˜¯å•Šï¼é˜³å…‰æ˜åªšçš„æ—¥å­æ€»æ˜¯è®©äººå¿ƒæƒ…æ„‰æ‚¦ â˜€ï¸ [1/5]  âœ… ç›¸å…³

ç”¨æˆ·: æˆ‘å¾ˆå¼€å¿ƒ
Bot: @ç”¨æˆ· å¤ªå¥½äº†ï¼çœ‹åˆ°ä½ å¼€å¿ƒæˆ‘ä¹Ÿå¾ˆé«˜å…´ ğŸ˜Š [2/5]  âœ… ç›¸å…³
```

---

## ğŸ”§ æŠ€æœ¯å®ç°

### Geminié…ç½®
```python
# APIé…ç½®
GEMINI_API_KEY = "AIzaSyDppOfiF2TVBlOjfq73y_51SExrYgYOoYQ"
genai.configure(api_key=GEMINI_API_KEY)
gemini_model = genai.GenerativeModel('gemini-2.0-flash-exp')
```

### æç¤ºè¯å·¥ç¨‹
```python
prompt = f"""ä½ æ˜¯å°çˆ±åŒå­¦ï¼Œä¸€ä¸ªæ¸©æš–ã€ç†è§£ã€æ”¯æŒçš„ç¾¤ç®¡ç†AIã€‚

å½“å‰å¯¹è¯è½®æ¬¡ï¼š[{round_num}/5]
ç”¨æˆ· @{username} è¯´ï¼š{user_message}

è¯·ç”¨æ¸©æš–ã€é«˜æƒ…å•†çš„æ–¹å¼å›å¤ï¼Œè¦æ±‚ï¼š
1. å›å¤è¦ç®€çŸ­ï¼ˆ1-2å¥è¯ï¼‰
2. ä½“ç°ç†è§£å’Œæ”¯æŒ
3. æ ¹æ®ç”¨æˆ·æ¶ˆæ¯å†…å®¹å›å¤
4. ä¸è¦é‡å¤ç”¨æˆ·çš„è¯
5. å¿…é¡»ä»¥ @{username} å¼€å¤´
6. å¿…é¡»ä»¥ [{round_num}/5] ç»“å°¾

å›å¤æ ¼å¼ï¼š@{username} [ä½ çš„å›å¤] [{round_num}/5]"""
```

### å¼‚æ­¥è°ƒç”¨
```python
# ä½¿ç”¨asyncio.to_threadé¿å…é˜»å¡
response = await asyncio.to_thread(
    gemini_model.generate_content,
    prompt
)
```

### é™çº§å¤„ç†
```python
try:
    # å°è¯•AIå›å¤
    reply = await gemini_api_call()
except Exception as e:
    # é™çº§åˆ°æ¨¡æ¿å›å¤
    logger.error(f"Gemini APIé”™è¯¯: {e}")
    reply = random.choice(templates)
```

---

## ğŸ“Š APIä½¿ç”¨æƒ…å†µ

### Gemini 2.0 Flash Exp
- **æ¨¡å‹**: gemini-2.0-flash-exp
- **é€Ÿåº¦**: è¶…å¿«ï¼ˆ<1ç§’ï¼‰
- **è´¨é‡**: é«˜è´¨é‡ç†è§£å’Œå›å¤
- **æˆæœ¬**: å…è´¹ï¼ˆå®éªŒç‰ˆï¼‰

### é…é¢é™åˆ¶
- RPM: 10æ¬¡/åˆ†é’Ÿ
- TPM: 4M tokens/åˆ†é’Ÿ
- RPD: 1500æ¬¡/å¤©

---

## ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜åŒ–

### 1. æ·»åŠ å¯¹è¯å†å²
```python
# ä¿å­˜æœ€è¿‘5è½®å¯¹è¯
history = memory.get_conversation_history(chat_id, user_id)

prompt = f"""
å†å²å¯¹è¯ï¼š
{history}

å½“å‰ç”¨æˆ·è¯´ï¼š{user_message}
è¯·æ ¹æ®å†å²ä¸Šä¸‹æ–‡å›å¤...
"""
```

### 2. å¤šBotåä½œ
```python
# å€©å€©å§å’ŒNotionåŠ©æ‰‹ä¹Ÿæ¥å…¥AI
async def qianqian_ai_reply(username, text):
    prompt = "ä½ æ˜¯å€©å€©å§ï¼Œé«˜å†·å¥³ç¥..."
    return await gemini_call(prompt)
```

### 3. æƒ…ç»ªè¯†åˆ«
```python
# è¯†åˆ«ç”¨æˆ·æƒ…ç»ª
emotion = await detect_emotion(user_message)
prompt = f"ç”¨æˆ·æƒ…ç»ªï¼š{emotion}ï¼Œè¯·é€‚å½“å›åº”..."
```

---

## âœ… éªŒè¯æ¸…å•

- âœ… Gemini APIé›†æˆ
- âœ… ä¸Šä¸‹æ–‡ç†è§£
- âœ… æ ¼å¼è§„èŒƒ
- âœ… å¼‚æ­¥å¤„ç†
- âœ… é™çº§æœºåˆ¶
- âœ… é”™è¯¯å¤„ç†

---

**AIé›†æˆå®Œæˆï¼** ğŸ‰

**ç«‹å³æµ‹è¯•**ï¼š
1. åœ¨ç¾¤é‡Œå‘é€: `å°çˆ± ä»Šå¤©å¤©æ°”çœŸå¥½`
2. è§‚å¯ŸBotæ˜¯å¦æ ¹æ®å†…å®¹å›å¤
3. ç»§ç»­å¯¹è¯ï¼Œçœ‹AIæ˜¯å¦ç†è§£ä¸Šä¸‹æ–‡
