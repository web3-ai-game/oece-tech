---
title: 知識庫結構總覽 - 維根斯坦瘋狂擴寫版
slug: wittgenstein-1-knowledge-base-overview
category: wittgenstein-expanded/1-知識庫總覽
tags: [知識庫, Firebase, 向量化检索, 蒸餾, Wittgenstein, Notion, deepweay-me, oece-tech, 擴寫]
lang: zh-TW
created: 2026-02-12
source: kilo-code-distilled-expanded
vector_ready: true
embedding_model: BAAI/bge-m3
expansion_level: crazy
---

# 1. 知識庫結構總覽

這是知識蒸餾知識庫的完整維根斯坦結構總覽。我們採用嚴格的數字層級系統（1. 1.1 1.11 ...），每個層級對應獨立 MD 文件或子目錄，確保邏輯遞進、易導航。這種結構不僅模仿維根斯坦《邏輯哲學論》的哲學組織方式，還完美適配現代工具：Notion 的頁面層級、Firebase 的 subcollection 與向量索引。

## 1.1 設計原則

### 1.11 適應 Firebase：每個 MD 文件帶 frontmatter，可拆分為 chunks 存入 Firestore/Realtime DB，每 chunk 有 id, text, vector, metadata。

Firebase 是本知識庫的核心存儲後端，其無伺服器架構允許無限擴展。每个文件經解析後拆分為 400-800 字 chunk，每 chunk 生成 embedding 存入專屬 collection。

**存儲結構範例：**

```json
{
  "collections": {
    "knowledge": {
      "docs": {
        "1-知識庫總覽": {
          "subcollection": "chunks",
          "chunk_1.1.1": {
            "text": "詳細 Firebase 適配內容...",
            "vector": [0.123, -0.456, ...],
            "metadata": {
              "level": "1.1.1",
              "parent": "1.1",
              "tags": ["firebase", "chunking"],
              "chunk_size": 512
            }
          }
        }
      }
    }
  }
}
```

**優點詳解：**
- **自動縮放**：支援百萬 chunk，無需管理伺服器。
- **實時同步**：多端更新即時反映，適合團隊協作。
- **安全規則**：
  ```javascript
  rules_version = '2';
  service cloud.firestore {
    match /databases/{database}/documents {
      match /knowledge/{doc} {
        allow read: if request.auth != null;
        allow write: if request.auth.uid == resource.data.owner;
      }
    }
  }
  ```

**比較表格：Firestore vs Realtime DB vs BigQuery：**

| 特徵 | Firestore | Realtime DB | BigQuery (向量擴展) |
|------|-----------|-------------|---------------------|
| 查詢類型 | 文檔/聚合/向量 | JSON樹狀 | SQL + Vertex AI |
| 成本模型 | 讀/寫/存儲 | 存儲/下載 | 查詢 TB/秒 |
| 向量支持 | Extensions | 無 | 原生 Match Embeddings |
| 推薦場景 | 結構化知識 | 實時聊天 | 大規模分析 |

**導入 Python 腳本（完整）：**

```python
import firebase_admin
from firebase_admin import credentials, firestore
from sentence_transformers import SentenceTransformer

cred = credentials.Certificate('service-account.json')
firebase_admin.initialize_app(cred)
db = firestore.client()

model = SentenceTransformer('BAAI/bge-m3')

def upload_chunk(path, text, level):
    emb = model.encode(text).tolist()
    data = {
        'text': text,
        'vector': emb,
        'metadata': {
            'level': level,
            'path': path
        }
    }
    db.collection('knowledge/1-知識庫總覽/chunks').add(data)

# 使用範例
upload_chunk('1.1.1', 'Firebase chunk 內容...', '1.1.1')
```

此腳本可批量處理整個 txt/ 目錄，生成向量庫索引。預計處理 100 文件需 30 分鐘。

### 1.12 支持向量化检索：使用 bge-m3 等模型生成 embedding，支持語義搜索（集成 Vertex AI 或 Pinecone）。

bge-m3 是 BAAI 開發的多語言 embedding 模型，支援 100+ 語言包括繁體中文，在 MTEB 基準中 C-MTEB 分數 65.95，優於 multilingual-e5-large。維度 1024，適合 Firebase Vertex AI Vector Search。

**完整流程：**
1. **Chunking**：使用 langchain.text_splitter.RecursiveCharacterTextSplitter(chunk_size=512, chunk_overlap=50)
2. **Embedding**：batch_encode 加速 GPU
3. **存儲**：Pinecone upsert 或 Firebase Vector Store
4. **檢索**：cosine similarity threshold 0.8

**Python 搜索範例：**

```python
import pinecone

pinecone.init(api_key="your-key", environment="us-west1-gcp")
index = pinecone.Index("knowledge-vectors")

query = "如何部署 Kali Linux 紅隊工具？"
q_emb = model.encode(query).tolist()
matches = index.query(q_emb, top_k=5, include_metadata=True)

for match in matches['matches']:
    print(match['metadata']['text'])
```

**性能優化：**
- Index type: cosine
- Pods: starter pod 1，擴展至 p1.x2
- Hybrid search：關鍵字 + 向量

**比較模型：**
| 模型 | 維度 | C-MTEB | 中文支持 |
|------|------|--------|----------|
| bge-m3 | 1024 | 65.95 | 優秀 |
| ada-002 | 1536 | 63.5 | 中等 |
| gte-large-zh | 1024 | 64.2 | 優秀 |

集成 Vertex AI：使用 google-cloud-aiplatform v1 VectorSearch，支援 RAG pipeline。

### 1.13 Wittgenstein 目錄結構：數字層級 1. 1.1 1.11 ... 邏輯遞進，便於 Notion 導入與導航。

靈感來源：《邏輯哲學論》7 命題系統，每數字代表獨立但依賴的論述單位。應用到文件系統：

**文件樹範例：**
```
txt/wittgenstein-expanded/
├── 1-知識庫總覽/
│   ├── 1.1-設計原則.md
│   └── 1.2-目錄樹.md
├── 2-confidential/
│   └── 2.1-UFO人類學.md
└── ...
```

**Notion 導入：**
1. 創建 Database "知識庫"
2. Properties: Level (title), Parent (relation), Content (rich_text), Tags (multi_select), Vector_ID (number)
3. 使用 API：
  ```python
  from notion_client import Client
  notion = Client(auth="secret_")
  new_page = notion.pages.create(
    parent={"database_id": db_id},
    properties={
      "Level": {
        "title": [{"text": {"content": "1.1.1"}}]
      }
    }
  )
  ```

導航：Notion 側邊欄自動生成樹狀結構，支持 collapse/expand。

**Firebase 對應：** level 作為 doc ID，parent_level 作為 field，便於遞歸查詢。

### 1.14 Notion 友好：純 MD，層級標題，checklist/code blocks。

Notion 原生支持 MD 語法轉換：
- # H1 → Toggle or Heading 1
- ## H2 → Heading 2
- - [ ] → To-do list
- ```python → Code block

**最佳實踐：**
- 使用 callout blocks 總結：> [!note] 關鍵點
- Synced block 跨頁重用代碼
- Database views: Table, Board (by category), Gallery (tags)

**批量導入工具：** notion-md-importer GitHub repo，或 Zapier MD to Notion。

### 1.15 GitHub 備份：整個 txt/ 可直接 push 至 repo，如 txt-DO-distilled。

**Git workflow：**
1. `git init txt-wittgenstein`
2. `git add .`
3. `git commit -m "初版維根斯坦擴寫"`
4. `git remote add origin git@github.com:user/txt-DO-distilled.git`
5. `git push -u origin main`

**CI/CD Actions (.github/workflows/embed.yml)：**
```yaml
on: push
jobs:
  embed:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Embed to Firebase
        run: python batch_embed.py
```

支援版本控制、issue tracking、PR review。

## 1.2 目錄樹

完整維根斯坦樹（擴寫版）：

```
txt/wittgenstein-expanded/
├── 1-知識庫總覽/
│   ├── 1.1-設計原則.md
│   ├── 1.2-目錄樹.md
│   ├── 1.3-Firebase導入指南.md
│   └── 1.4-使用說明.md
├── 2-confidential/
│   └── 2.1-UFO人類學/2.1.md  # 擴寫 Roswell 等
├── 3-survival-skills/
│   ├── 3.1-街頭格鬥.md
│   ├── 3.2-數字遊民簽證.md
│   └── 3.3-社會工程防禦.md
├── 4-deepweay-me/
│   └── 4.1-ethical-hacking/
│       ├── 4.1.1-red-team-a.md
│       ├── 4.1.2-red-team-b.md
│       ├── 4.1.3-red-team-c.md
│       ├── 4.1.4-blue-team-a.md
│       ├── 4.1.5-blue-team-b.md
│       └── 4.1.6-blue-team-c.md
└── 5-oece-tech/
    └── 5.1-novel-script-engine/
        └── 5.1.1-爽文劇本結構.md
```

每個文件將瘋狂擴寫至原 10 倍內容，加入案例、表格、代碼、checklist。

## 1.3 Firebase 導入指南

### 1.31 拆分 chunks：每 500 字一段，生成 embedding。

使用 langchain 或 custom splitter：重疊 20% 避免上下文斷裂。

**腳本：**
```python
from langchain.text_splitter import RecursiveCharacterTextSplitter

splitter = RecursiveCharacterTextSplitter(chunk_size=500, chunk_overlap=100)
chunks = splitter.split_text(full_md_content)
```

### 1.32 存儲結構：詳見 1.11 JSON。

metadata 擴展：add timestamps, author, references。

### 1.33 搜索：使用 cosine similarity on vectors。

閾值 0.75+，後處理 rerank 使用 cross-encoder。

## 1.4 使用說明

- **閱覽**：VSCode 或 Typora MD 預覽。
- **Notion**：拖入資料夾，自動層級。
- **Firebase**：跑 batch_upload.py。
- **搜索**：語義查詢如 "紅隊 Kali 部署" 得相關 chunk。

**後續**：所有文件依此填充，基於權威來源，持續蒸餾更新。