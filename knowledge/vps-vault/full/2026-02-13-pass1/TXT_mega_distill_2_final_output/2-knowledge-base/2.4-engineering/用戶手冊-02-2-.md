---
distilled_by: grok-4-0709
mode: B
---
part: 2
---

## 2. 初始設定與環境配置

要啟動 MD 推演系統，只需最小改動：配置 .env 檔案。這是環境變數管理的標準實踐，源自於軟體工程中的配置分離原則（configuration separation），確保敏感資訊（如 API key）不硬編碼進程式碼。

### 2.1 背景與原理

.env 檔案是 dotenv 模組的產物，用於 Node.js 環境中載入變數。原理是將 key-value 對解析為 process.env 物件，避免 git 洩漏機密。xAI API key 來自 xAI 官方平台，用於驗證請求。

### 2.11 實例步驟

1. 在專案根目錄建立 .env 檔案。
2. 輸入：XAI_API_KEY=你的xAI_API_KEY
3. 保存後，重啟應用以載入。

### 2.2 配置範例代碼

以下是 5-8 個代碼範例，涵蓋不同情境，均帶註釋。

#### 範例 1: 基本 .env 配置 (Node.js)
```javascript
// .env 文件內容
XAI_API_KEY=sk-你的key-這裡 // 註釋：替換為真實 key，避免暴露在程式碼中
```

#### 範例 2: 在 VSCode 載入 .env (使用 dotenv 套件)
```javascript
// index.js
require('dotenv').config(); // 註釋：載入 .env 變數
console.log(process.env.XAI_API_KEY); // 註釋：驗證 key 是否可用
```

#### 範例 3: API 呼叫範例 (使用 axios)
```javascript
const axios = require('axios');
require('dotenv').config(); // 註釋：確保 key 載入

async function callXAI(prompt) {
  try {
    const response = await axios.post('https://api.xai.com/v1/chat', { // 註釋：xAI API 端點，依官方文件更新
      model: 'grok-beta', // 註釋：指定模型
      messages: [{ role: 'user', content: prompt }]
    }, {
      headers: { Authorization: `Bearer ${process.env.XAI_API_KEY}` } // 註釋：使用 .env 中的 key
    });
    return response.data.choices[0].message.content; // 註釋：提取回應
  } catch (error) {
    console.error('API 錯誤:', error); // 註釋：錯誤處理
  }
}
```

#### 範例 4: 錯誤處理增強版
```javascript
// 擴展自範例 3
async function callXAI(prompt) {
  // ... (前略)
  } catch (error) {
    if (error.response && error.response.status === 401) { // 註釋：檢查未授權錯誤
      throw new Error('無效的 XAI_API_KEY，請檢查 .env');
    }
    // ... (其他錯誤)
  }
}
```

#### 範例 5: 整合到推演腳本
```javascript
// script.js
require('dotenv').config();
const prompt = '生成角色卡'; // 註釋：來自用戶手冊的提示詞
callXAI(prompt).then(result => console.log(result)); // 註釋：執行推演
```

#### 範例 6: Bash 腳本載入 .env
```bash
# load_env.sh
export $(grep -v '^#' .env | xargs) # 註釋：將 .env 變數匯出到 shell
echo $XAI_API_KEY # 註釋：驗證
```

#### 範例 7: Python 版本 (跨語言實例)
```python
# config.py
import os
from dotenv import load_dotenv # 註釋：Python dotenv 套件
load_dotenv() # 註釋：載入 .env
api_key = os.getenv('XAI_API_KEY') # 註釋：存取 key
print(api_key) # 註釋：測試
```

#### 範例 8: Docker 整合 .env
```dockerfile
# Dockerfile
FROM node:14
COPY .env . # 註釋：複製 .env 到容器
RUN npm install dotenv # 註釋：安裝依賴
CMD ["node", "index.js"] # 註釋：啟動時自動載入
```
