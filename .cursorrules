# DeepWeay + OECE åŒé¡¹ç›®å¼€å‘è§„åˆ™

## é¡¹ç›®èº«ä»½
- **deepweay.me**: AI ç¤¾ç¾¤å¨±ä¹å¹³å°ï¼ˆä¸œå—äºšå¸‚åœºï¼‰
- **oece.tech**: AI å·¥å…·èšåˆç«™ï¼ˆ60+ å·¥å…·ï¼‰
- **æŠ€æœ¯æ ˆ**: Next.js 16 + TypeScript + Firebase + Cloud Run + Gemini API
- **æœ¬åœ°è·¯å¾„**: /Users/sms/GCP/deepweay-me å’Œ /Users/sms/GCP/oece-tech

## ä»£ç ç”ŸæˆåŸåˆ™

### 1. è¯­è¨€ä¼˜å…ˆçº§
```
Go (é¦–é€‰åç«¯) > TypeScript (å‰ç«¯/APIè·¯ç”±) > Rust (æ€§èƒ½æ¨¡å—) > Python (é¿å…ä½¿ç”¨)
```

### 2. å‘½åçº¦å®š
- ç»„ä»¶æ–‡ä»¶: `PascalCase.tsx` (ä¾‹: `UserCard.tsx`, `ChatInput.tsx`)
- å‡½æ•°/å˜é‡: `camelCase` (ä¾‹: `getUserTokens`, `isAuthenticated`)
- å¸¸é‡/ç¯å¢ƒå˜é‡: `UPPER_SNAKE_CASE` (ä¾‹: `MAX_TOKENS`, `API_BASE_URL`)
- API è·¯ç”±: `kebab-case` (ä¾‹: `/api/user-tokens`, `/api/gemini/chat`)
- æ–‡ä»¶å¤¹: `kebab-case` (ä¾‹: `chat-playground`, `user-profile`)

### 3. ç›®å½•ç»“æ„è¯†åˆ«
```
app/
â”œâ”€â”€ page.tsx                 # é¦–é¡µ
â”œâ”€â”€ chat/page.tsx            # AI Chat åŠŸèƒ½é¡µ
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ gemini/              # AI ç›¸å…³ API
â”‚   â”‚   â”œâ”€â”€ chat/route.ts
â”‚   â”‚   â””â”€â”€ stream/route.ts
â”‚   â””â”€â”€ user/                # ç”¨æˆ·ç›¸å…³ API
â”‚       â””â”€â”€ tokens/route.ts
components/
â”œâ”€â”€ ui/                      # shadcn/ui åŸºç¡€ç»„ä»¶
â”œâ”€â”€ chat/                    # Chat åŠŸèƒ½ç»„ä»¶
â”œâ”€â”€ layout/                  # å¸ƒå±€ç»„ä»¶
â””â”€â”€ shared/                  # å…±äº«ç»„ä»¶
lib/
â”œâ”€â”€ firebase.ts              # Firebase åˆå§‹åŒ–
â”œâ”€â”€ gemini.ts                # Gemini API å°è£…
â””â”€â”€ utils.ts                 # å·¥å…·å‡½æ•°
```

## ä»£ç æ¨¡æ¿

### API Route æ¨¡æ¿ (TypeScript)
```typescript
import { NextRequest, NextResponse } from 'next/server'
import { rateLimit } from '@/lib/rate-limit'

export async function POST(req: NextRequest) {
  try {
    // 1. é™æµæ£€æŸ¥
    const identifier = req.ip ?? 'anonymous'
    const { success } = await rateLimit.check(identifier)
    if (!success) {
      return NextResponse.json(
        { error: 'Too many requests' },
        { status: 429 }
      )
    }

    // 2. è¯·æ±‚è§£æ
    const body = await req.json()
    
    // 3. ä¸šåŠ¡é€»è¾‘
    const result = await processRequest(body)
    
    // 4. è¿”å›å“åº”
    return NextResponse.json({
      success: true,
      data: result,
      timestamp: new Date().toISOString()
    })
    
  } catch (error) {
    console.error('API Error:', error)
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    )
  }
}
```

### React ç»„ä»¶æ¨¡æ¿
```typescript
'use client'

import { useState, useEffect } from 'react'
import { cn } from '@/lib/utils'

interface ComponentNameProps {
  className?: string
  // å…¶ä»– props
}

export function ComponentName({ className }: ComponentNameProps) {
  const [state, setState] = useState<Type>(initialValue)

  useEffect(() => {
    // å‰¯ä½œç”¨é€»è¾‘
  }, [dependencies])

  return (
    <div className={cn('base-styles', className)}>
      {/* JSX å†…å®¹ */}
    </div>
  )
}
```

### Firestore æ“ä½œæ¨¡æ¿
```typescript
import { 
  collection, 
  doc, 
  getDoc, 
  setDoc, 
  updateDoc 
} from 'firebase/firestore'
import { db } from '@/lib/firebase'

// è¯»å–æ–‡æ¡£
export async function getDocument(collectionName: string, docId: string) {
  const docRef = doc(db, collectionName, docId)
  const docSnap = await getDoc(docRef)
  return docSnap.exists() ? docSnap.data() : null
}

// åˆ›å»º/æ›´æ–°æ–‡æ¡£
export async function setDocument(
  collectionName: string, 
  docId: string, 
  data: any
) {
  const docRef = doc(db, collectionName, docId)
  await setDoc(docRef, {
    ...data,
    updatedAt: new Date().toISOString()
  }, { merge: true })
}
```

## å½“å‰å¼€å‘é˜¶æ®µ

### å·²å®Œæˆ âœ…
- æ‰€æœ‰ UI é¡µé¢ï¼ˆdeepweay.me å’Œ oece.techï¼‰
- AI Chat Playground
- ä¸»é¢˜åˆ‡æ¢ç³»ç»Ÿ
- ç¿»è¯‘ç³»ç»Ÿï¼ˆè‹±æ–‡ â†” ç¹ä¸­ï¼‰
- SEO ä¼˜åŒ–

### æ­£åœ¨è¿›è¡Œ ğŸ”„
- Firebase Hosting åŸŸåé…ç½®
- DNS A è®°å½•è®¾ç½®ï¼ˆç­‰å¾… SSL ç”Ÿæ•ˆï¼‰

### å¾…å¼€å‘ ğŸ“‹ (æŒ‰ä¼˜å…ˆçº§)
1. **P1 - æœ¬å‘¨**:
   - Firebase Auth é›†æˆï¼ˆæ›¿æ¢å ä½ç™»å½•ï¼‰
   - è·¯ç”±ä¿æŠ¤ä¸­é—´ä»¶
   - ç”¨æˆ· Token åˆå§‹åŒ–

2. **P2 - ä¸‹å‘¨**:
   - å¯¹è¯å†å²å­˜å‚¨ï¼ˆFirestoreï¼‰
   - Token è®¡è´¹ç³»ç»Ÿ
   - è®ºå›çœŸå®æ•°æ®æ¥å…¥

3. **P3 - åç»­**:
   - Telegram Bot å‡çº§
   - æ”¯ä»˜é›†æˆ
   - ç®¡ç†åå°å®Œå–„

## å¼€å‘çº¦æŸ

### âœ… å¿…é¡»åš
1. æ‰€æœ‰ API å¿…é¡»æœ‰é™æµä¿æŠ¤
2. ç¯å¢ƒå˜é‡å¿…é¡»ä½¿ç”¨ `NEXT_PUBLIC_` å‰ç¼€ï¼ˆå‰ç«¯ï¼‰æˆ–æ— å‰ç¼€ï¼ˆæœåŠ¡ç«¯ï¼‰
3. ç»„ä»¶å¿…é¡»ä½¿ç”¨ TypeScript ä¸¥æ ¼ç±»å‹
4. API å“åº”å¿…é¡»åŒ…å« `{ success, data, error }` ç»“æ„
5. é”™è¯¯å¿…é¡»æœ‰æ˜ç¡®çš„ HTTP çŠ¶æ€ç å’Œé”™è¯¯æ¶ˆæ¯

### âŒ ç¦æ­¢åš
1. ä¸è¦ç¡¬ç¼–ç  API å¯†é’¥
2. ä¸è¦åœ¨å‰ç«¯ç›´æ¥è°ƒç”¨åç«¯æœåŠ¡ï¼ˆå¿…é¡»é€šè¿‡ API Routesï¼‰
3. ä¸è¦ä½¿ç”¨ Pythonï¼ˆé™¤éæ²¡æœ‰å…¶ä»–é€‰æ‹©ï¼‰
4. ä¸è¦åˆ›å»ºè¶…è¿‡ 3 å±‚çš„åµŒå¥—ç»„ä»¶
5. ä¸è¦å¿½ç•¥ TypeScript ç±»å‹é”™è¯¯

## AI æ¨¡å‹é›†æˆ

### Gemini API è°ƒç”¨ç¤ºä¾‹
```typescript
import { GoogleGenerativeAI } from '@google/generative-ai'

const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY!)

export async function chatWithGemini(
  message: string,
  model: 'gemini-lite' | 'gemini-flash' | 'gemini-pro' = 'gemini-flash'
) {
  const modelInstance = genAI.getGenerativeModel({ model })
  
  const result = await modelInstance.generateContent({
    contents: [{ role: 'user', parts: [{ text: message }] }],
    generationConfig: {
      temperature: 0.7,
      maxOutputTokens: 2048,
    }
  })
  
  return result.response.text()
}
```

## éƒ¨ç½²å‘½ä»¤
```bash
# æœ¬åœ°å¼€å‘
npm run dev

# æ„å»º
npm run build

# éƒ¨ç½²åˆ° Firebase Hosting
firebase deploy --only hosting

# éƒ¨ç½² Cloud Run API
gcloud run deploy api-service \
  --source . \
  --region asia-southeast1 \
  --allow-unauthenticated
```

## ç¯å¢ƒå˜é‡æ£€æŸ¥æ¸…å•

### å‰ç«¯ï¼ˆNEXT_PUBLIC_*ï¼‰
- [ ] NEXT_PUBLIC_FIREBASE_API_KEY
- [ ] NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN
- [ ] NEXT_PUBLIC_FIREBASE_PROJECT_ID
- [ ] NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET
- [ ] NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID
- [ ] NEXT_PUBLIC_FIREBASE_APP_ID

### æœåŠ¡ç«¯
- [ ] GEMINI_API_KEY (+ GEMINI_API_KEY_1 åˆ° 28 ç”¨äºè½®æ¢)
- [ ] GROK_API_KEY
- [ ] CLAUDE_API_KEY
- [ ] MONGODB_URI
- [ ] SUPABASE_URL
- [ ] SUPABASE_ANON_KEY
- [ ] UPSTASH_REDIS_REST_URL
- [ ] TELEGRAM_BOT_TOKEN

## ä»£ç å®¡æŸ¥æ ‡å‡†

åœ¨ç”Ÿæˆä»£ç å‰ï¼Œç¡®ä¿ï¼š
1. **ç±»å‹å®‰å…¨**: æ‰€æœ‰å˜é‡å’Œå‡½æ•°æœ‰æ˜ç¡®ç±»å‹
2. **é”™è¯¯å¤„ç†**: try-catch åŒ…è£¹å¼‚æ­¥æ“ä½œ
3. **æ€§èƒ½ä¼˜åŒ–**: é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“å’Œ API è°ƒç”¨
4. **å¯è¯»æ€§**: æ¸…æ™°çš„å˜é‡å‘½åå’Œæ³¨é‡Š
5. **å¯ç»´æŠ¤æ€§**: æ¨¡å—åŒ–è®¾è®¡ï¼Œå•ä¸€èŒè´£åŸåˆ™

## å“åº”æ ¼å¼

å½“æˆ‘è¯´ "åˆ›å»ºç”¨æˆ·ç™»å½•é¡µé¢" æˆ– "æ·»åŠ  Token æ‰£é™¤åŠŸèƒ½"ï¼Œä½ åº”è¯¥ï¼š
1. **è¯†åˆ«æ¨¡å—**: åˆ¤æ–­æ˜¯å‰ç«¯ç»„ä»¶è¿˜æ˜¯ API Route
2. **é€‰æ‹©è¯­è¨€**: å‰ç«¯ç”¨ TypeScriptï¼Œåç«¯ä¼˜å…ˆ Goï¼ˆå¦‚æœæ˜¯ API Routes åˆ™ TypeScriptï¼‰
3. **ç”Ÿæˆå®Œæ•´ä»£ç **: åŒ…æ‹¬å¯¼å…¥ã€ç±»å‹å®šä¹‰ã€ä¸»é€»è¾‘ã€é”™è¯¯å¤„ç†
4. **æä¾›æ–‡ä»¶è·¯å¾„**: æ˜ç¡®å‘Šè¯‰æˆ‘ä»£ç åº”è¯¥æ”¾åœ¨å“ªä¸ªæ–‡ä»¶
5. **åˆ—å‡ºä¾èµ–**: å¦‚æœéœ€è¦å®‰è£…æ–°åŒ…ï¼Œåˆ—å‡º npm install å‘½ä»¤

## ç¤ºä¾‹äº¤äº’

**æˆ‘è¯´**: "æ·»åŠ ç”¨æˆ· Token æ‰£é™¤åŠŸèƒ½"

**ä½ åº”è¯¥è¾“å‡º**:
```
ğŸ“ æ–‡ä»¶: app/api/user/deduct-tokens/route.ts

import { NextRequest, NextResponse } from 'next/server'
import { doc, updateDoc, increment } from 'firebase/firestore'
import { db } from '@/lib/firebase'

export async function POST(req: NextRequest) {
  try {
    const { userId, amount } = await req.json()
    
    if (!userId || !amount) {
      return NextResponse.json(
        { error: 'Missing userId or amount' },
        { status: 400 }
      )
    }

    const userRef = doc(db, 'users', userId)
    await updateDoc(userRef, {
      tokens: increment(-amount),
      tokensUsed: increment(amount),
      lastDeductedAt: new Date().toISOString()
    })

    return NextResponse.json({ success: true })
  } catch (error) {
    console.error('Token deduction error:', error)
    return NextResponse.json(
      { error: 'Failed to deduct tokens' },
      { status: 500 }
    )
  }
}

ğŸ“¦ æ— éœ€é¢å¤–ä¾èµ–
âœ… å·²åŒ…å«é”™è¯¯å¤„ç†å’Œç±»å‹å®‰å…¨
```

---

## æœ€åæé†’

- **ç›´æ¥ç»™æ–¹æ¡ˆï¼Œä¸é—®é€‰æ‹©é¢˜**
- **ä»£ç å¿…é¡»å¯ä»¥ç›´æ¥è¿è¡Œ**
- **ä¼˜å…ˆä½¿ç”¨å…è´¹èµ„æºï¼ˆGitHub Student Packï¼‰**
- **æˆæœ¬æ•æ„Ÿï¼šä¼˜å…ˆ Firebase å…è´¹å±‚ + GCP $300 Credit**
- **Markdown æ ¼å¼è¾“å‡ºï¼Œæ–¹ä¾¿å¤åˆ¶åˆ° Notion**## ç´¢å¼•æ’é™¤è§„åˆ™

å¿½ç•¥ä»¥ä¸‹ç›®å½•ï¼š
- node_modules/
- .next/
- .firebase/
- dist/
- build/
- coverage/
- .git/

åªç´¢å¼•æ ¸å¿ƒä»£ç ï¼š
- app/
- components/
- lib/
- public/
- styles/# ä¾èµ–
node_modules/
.pnpm-store/

# æ„å»ºäº§ç‰©
.next/
out/
dist/
build/

# Firebase
.firebase/
firebase-debug.log

# æ—¥å¿—
*.log
npm-debug.log*

# ç¯å¢ƒå˜é‡
.env
.env.local
.env.*.local

# æµ‹è¯•
coverage/
.nyc_output/

# IDE
.vscode/
.idea/

# ä¸´æ—¶æ–‡ä»¶
*.tmp
*.temp
.DS_Store
```

### 3. éªŒè¯æ–‡æ¡£æ˜¯å¦ç”Ÿæ•ˆ

æ·»åŠ å®Œæ–‡æ¡£åï¼Œåœ¨ Cursor Chat æµ‹è¯•ï¼š
```
"å¦‚ä½•åœ¨ Next.js App Router ä¸­ä½¿ç”¨ Firebase Authï¼Ÿ"
"Gemini API çš„æµå¼å“åº”æ€ä¹ˆå®ç°ï¼Ÿ"
"GCP Cloud Run çš„ç¯å¢ƒå˜é‡æ€ä¹ˆé…ç½®ï¼Ÿ"